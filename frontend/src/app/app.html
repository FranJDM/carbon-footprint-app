<!-- src/app/app.html -->
<div class="layout">
  <!-- Panel lateral -->
  <aside class="sidebar">
    <nav>
      <div class="menu-section">
        <p class="menu-companies">Empresas</p>
        <button class="nav-btn" (click)="viewCompanies()">ğŸ‘ï¸ Ver Empresas</button>
  <button class="nav-btn" (click)="showAddCompanyForm()">â• AÃ±adir Empresa</button>

      </div>

      <div class="menu-section">
        <p class="menu-emissions">Emisiones</p>
        <button class="nav-btn" (click)="viewAllEmissions()">ğŸ“Š Ver Todas las Emisiones</button>
  <button class="nav-btn"(click)="showAddEmissionForm()">â• AÃ±adir EmisiÃ³n</button>

      </div>
    </nav>
  </aside>

  <!-- Ãrea principal -->
  <main class="main-content">
    <header class="main-header">
      <div class="header-content">
        <div class="logo-animation">
          <span class="leaf">ğŸŒ¿</span>
          <span class="main-globe">ğŸŒ</span>
          <span class="leaf">ğŸƒ</span>
        </div>
        <h1 class="header-title">Track your Carbon FootPrint</h1>
        <div class="header-subtitle">
          <span class="subtitle-item">Sostenibilidad</span>
          <span class="divider">â€¢</span>
          <span class="subtitle-item">MediciÃ³n</span>
          <span class="divider">â€¢</span>
          <span class="subtitle-item">Impacto</span>
        </div>
      </div>
    </header>

    <section class="content-area">
      <!-- Formulario de empresa (crear / editar) -->
      <app-company-list
        *ngIf="currentView === 'companyForm'"
        [editingCompany]="editingCompany"
        (companyAdded)="onCompanyOperationCompleted()"
        (operationCompleted)="onCompanyOperationCompleted()"
        (companySelected)="onCompanySelected($event)">
      </app-company-list>

      <!-- Formulario de emisiÃ³n -->
      <app-emission-list
        *ngIf="currentView === 'emissionForm'"
        [company]="selectedCompany"
        (emissionAdded)="onEmissionAdded()"
        (goBackToList)="onGoBackToList()">
      </app-emission-list>

      <!-- Emisiones de empresa seleccionada -->
      <div *ngIf="selectedCompany && currentView === 'companies'" class="table-container">
        <h3>Emisiones de {{ selectedCompany.name }}</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Tipo</th>
              <th>Cantidad (kWh)</th>
              <th>kgCOâ‚‚e</th>
              <th>Fecha</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let emission of allEmissions">
              <td>{{ emission.type }}</td>
              <td>{{ emission.amount }}</td>
              <td>{{ emission.co2e }}</td>
              <td>{{ emission.date | date: 'dd/MM/yyyy' }}</td>
              <td>
                <button class="btn icon delete" (click)="deleteEmission(emission.id)" title="Eliminar emisiÃ³n">ğŸ—‘ï¸</button>
              </td>
            </tr>
            <tr *ngIf="allEmissions.length === 0">
              <td colspan="5">Esta empresa aÃºn no tiene emisiones registradas.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Tabla de empresas -->
      <div *ngIf="currentView === 'companies'" class="card">
        <h2>ğŸ¢ Lista de Empresas</h2>

        <div class="filter-controls">
          <input type="text" [(ngModel)]="companyFilter" placeholder="ğŸ” Filtrar por nombre o sector" class="filter-input">

          <div class="sort-buttons">
            <button (click)="sortCompanies('name')" [class.active]="companySortField === 'name'">
              ğŸ“› Nombre {{ companySortField === 'name' ? (companySortDirection === 'asc' ? 'â†‘' : 'â†“') : '' }}
            </button>
            <button (click)="sortCompanies('sector')" [class.active]="companySortField === 'sector'">
              ğŸ­ Sector {{ companySortField === 'sector' ? (companySortDirection === 'asc' ? 'â†‘' : 'â†“') : '' }}
            </button>
            <button (click)="sortCompanies('emissions')" [class.active]="companySortField === 'emissions'">
              â˜ï¸ Emisiones {{ companySortField === 'emissions' ? (companySortDirection === 'asc' ? 'â†‘' : 'â†“') : '' }}
            </button>
          </div>
        </div>

        <table class="data-table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Sector</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let company of companies | filter:companyFilter:['name','sector']">
              <td>{{ company.name }}</td>
              <td>{{ company.sector }}</td>
              <td>
                <div class="action-buttons-group">
                  <button class="btn icon view" (click)="viewCompanyEmissions(company)" title="Ver Emisiones">ğŸ‘ï¸</button>
                  <button class="btn icon edit" (click)="editCompany(company)" title="Editar">âœï¸</button>
                  <button class="btn icon delete" (click)="deleteCompany(company)" title="Eliminar">ğŸ—‘ï¸</button>
                  <button class="btn icon add" (click)="addEmission(company)" title="AÃ±adir EmisiÃ³n">â•</button>
               <button (click)="exportEmissionsToCSV(company)" title="Exportar en CSV"class="btn icon export">ğŸ“</button>

                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Tabla de todas las emisiones -->
      <div *ngIf="currentView === 'emissions'" class="card">
        <h2>ğŸ“Š Lista de Emisiones</h2>

        <div class="sort-buttons">
          <button (click)="sortEmissions('type')" [class.active]="emissionSortField === 'type'">ğŸ”§ Tipo {{ emissionSortField === 'type' ? (emissionSortDirection === 'asc' ? 'â†‘' : 'â†“') : '' }}</button>
          <button (click)="sortEmissions('amount')" [class.active]="emissionSortField === 'amount'">âš–ï¸ Cantidad {{ emissionSortField === 'amount' ? (emissionSortDirection === 'asc' ? 'â†‘' : 'â†“') : '' }}</button>
          <button (click)="sortEmissions('co2e')" [class.active]="emissionSortField === 'co2e'">ğŸŒ¡ï¸ CO2e {{ emissionSortField === 'co2e' ? (emissionSortDirection === 'asc' ? 'â†‘' : 'â†“') : '' }}</button>
          <button (click)="sortEmissions('date')" [class.active]="emissionSortField === 'date'">ğŸ“… Fecha {{ emissionSortField === 'date' ? (emissionSortDirection === 'asc' ? 'â†‘' : 'â†“') : '' }}</button>
        </div>

        <table class="data-table">
          <thead>
            <tr>
              <th>Empresa</th>
              <th>Tipo</th>
              <th>Cantidad</th>
              <th>CO2e (kg)</th>
              <th>Fecha</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let emission of allEmissions">
              <td>{{ emission.company.name }}</td>
              <td>{{ emission.type }}</td>
              <td>{{ emission.amount | number }}</td>
              <td>{{ emission.co2e | number }}</td>
              <td>{{ emission.date | date:'dd/MM/yyyy' }}</td>
              <td>
                <button class="btn icon delete" (click)="deleteEmission(emission.id)" title="Eliminar emisiÃ³n">ğŸ—‘ï¸</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
    <footer class="app-footer">
  <div class="footer-content">
    <a href="https://github.com/FranJDM" target="_blank" title="GitHub" class="footer-icon">ğŸ”â€‹</a>
    <a href="https://www.linkedin.com/in/fjdm" target="_blank" title="LinkedIn" class="footer-icon">ğŸ”—</a>
  </div>
</footer>
  </main>
  

</div>
